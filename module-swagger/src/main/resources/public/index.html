<html>
<head>
    <meta http-equiv="Content-Type">
    <meta content="text/html; charset=utf-8">
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <meta name="format-detection" content="email=no">
    <title>MINLIA开发者工具</title>
    <link rel="stylesheet" href="css/comment.css">
    <style type="text/css">

        @media only screen and (min-width: 401px) {
            html {
                font-size: 22px !important;
            }
        }

        @media only screen and (min-width: 428px) {
            html {
                font-size: 23px !important;
            }
        }

        @media only screen and (min-width: 481px) {
            html {
                font-size: 27px !important;
            }
        }

        @media only screen and (min-width: 569px) {
            html {
                font-size: 31px !important;
            }
        }

        @media only screen and (min-width: 641px) {
            html {
                font-size: 33px !important;
            }
        }

        html {
            -webkit-text-size-adjust: none;
            font-size: 20px;
            height: 100%;
        }

        body {
            min-width: 16rem;
            font-family: "STHeiti", "Microsoft YaHei", "Microsoft YaHei", "SimHei", "Arial Black";
            font-weight: lighter;
            background: #FFFFFF;
            margin: 60px;
        }

        .in-token {
            border: 0;
            height: 2rem;
            width: 100%;
            color: #BCBCBC;
            font-size: 0.9rem;
        }

        #confirm, .btn {
            border: 0;
            background-size: 100%;
            background-color: #F5F5F5;
            background-image: url('img/greenbtn.png');
            background-repeat: no-repeat;
            width: 12rem;
            height: 2rem;
            color: white;
            font-size: 0.9rem;
            margin-top: 1.3rem;
        }

    </style>
</head>

<body class="pagecolor">
<div>
    <div>
        <input type="text" id="codeContent" name="codeContent" class="in-token" placeholder="CODE" value=""/>
    </div>
    <div class="line"></div>
</div>

<div style="text-align: center;">
    <input type="button" id="confirm" value="复制Bearer Token" data-clipboard-target="#codeContent"/> <br>
    <input type="button" id="openSwagger" class="btn" value="打开Swagger UI"/> <br>
    <input type="button" id="refresh" class="btn" value="刷新页面"/> <br>
    <input type="text" id="username" name="username" class="btn" placeholder="用户名/手机号码/邮箱"/> <br>
    <input type="text" id="password" name="password" class="btn" placeholder="密码"/> <br>
    <input type="button" id="login" class="btn" value="登录"/> <br>
</div>
</body>

<script src="js/clipboard.min.js"></script>
<script src="js/jquery-1.9.1.min.js"></script>

<script>

    function login() {
        var username = $("#username").val();
        var password = $("#password").val();

        var url = '/api/auth/login';
        var data = {'username': username, 'password': password};
        $.ajax({
            url: url,
            data: JSON.stringify(data),
            type: 'POST',
            contentType: "application/json",
            dataType: "json",
            success: function (response) {
                $("#codeContent").val('Bearer ' + response.payload.token);
                $('#openSwagger').on('click', function () {
                    var swaggerUiUrl = "/swagger-ui.html";
                    window.open(swaggerUiUrl, "_blank");
                });
            },
            error: function (request, textStatus, errorThrown) {
                $("#codeContent").val("" + textStatus + " " + errorThrown);
                $('#openSwagger').on('click', function () {
                    return false;
                });
            }
        })
    }

    $(function () {
        $('#refresh').on('click', function () {
            window.location.reload(true);
        });

        $('#login').on('click', function () {
            login();
        });

        //复制
        var clipboard = new Clipboard('#confirm');
        clipboard.on('success', function (e) {
            e.clearSelection();
        });

        clipboard.on('error', function (e) {
            console.error('Action:', e.action);
            console.error('Trigger:', e.trigger);
        });
    });
</script>

</body>
</html>